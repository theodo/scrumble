angular.module 'Scrumble.daily-report'
.service 'reportBuilder', (
  $q
  Sprint
  Project
  trelloUtils
  dynamicFields
  sprintUtils
  bdc
)->
  converter = new showdown.Converter()

  renderBDC = (message, svg, useCid) ->
    bdc.getPngBase64(svg)
    .then (bdcBase64) ->
      src = if useCid then 'cid:bdc' else bdcBase64

      base64bis = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAIAAAD6CAYAAAA7ruXSAAAgAElEQVR4Xu2dCbxd49X/VyKDDBISEtWKlwqtmHVSipqqVUVrVoqqWSSoEsQQMUVCYkpRs5hLhQ6m11S0WqkSWqmhMdMbCRkkuUn+Z+2+5/5Pbu6593n2Xvuufc79ns+nn7a5a63n2d/13L3W8zvP3rfTktJH+EAAAhCAAAQgAAEIQAACEIAABCDQIQh0QgjoEHnmIiEAAQhAAAIQgAAEIAABCEAAAgkBhAAWAgQgAAEIQAACEIAABCAAAQhAoAMRQAjoQMnmUiEAAQhAAAIQgAAEIAABCEAAAggBrAEIQAACEIAABCAAAQhAAAIQgEAHIoAQ0IGSzaVCAAIQgAAEIAABCEAAAhCAAAQQAlgDEIAABCAAAQhAAAIQgAAEIACBDkQAIaADJZtLhQAEIAABCEAAAhCAAAQgAAEIIASwBiAAAQhAAAIQgAAEIAABCEAAAh2IAEJAB0o2lwoBCEAAAhCAAAQgAAEIQAACEEAIYA1AAAIQgAAEIAABCEAAAhCAAAQ6EAGEAKdkz5gxQ+bOnStf+MIXnGaw9LCNjY3JfPr06ZNqPvPnz5cPPvhABg0alMq/Vp3efvtt6dWrl6y00kq1egnMGwIQgAAEIAABCEAAAhDoYAQQApwSftddd8nChQtl3333dZnBggULpFu3bk1jZ53P3/72N3nggQfk1FNPTXU9zeeTKoiD0+jRo2WnnXaSzTbbzGF0hoQABCAAAQhAAAIQgAAEIBBPIBch4LTTTpP//Oc/0rlzZ+nXr5989atflR/84AfSqVOn+BnWqUfWjXcWLH/5y1/k8ccflxNOOKEQQkBL82l+fYsXL5Ybb7xRPvvsMzniiCOafvzee+/JtddeK++++66sv/76cvDBB8vyyy+fBU+UL0JAFC6MIQABCEAAAhCAAAQgAIECEMhFCDj66KPluOOOk8997nPy73//W2644QbZdttt5bvf/W4BLrkYU/AUAv70pz/Jk08+KSeeeGIhhICW5lOZpenTp8vtt98u77zzjnzpS19qEgKWLFkiZ599tqy33nrJ+tJ1pmuuPU9ZIAQU4/eJWUAAAhCAAAQgAAEIQAAC4QRyEwJOPvlkWX311ZOZ6Cbu448/TjZwzTd9jzzyiEybNq1pc/fQQw/JH/7wh+Sb3xVXXFF++MMfyqabbiqvvPKKTJo0SRoaGmTAgAFyxhlnLHXCoCw46EmErl27ygYbbCB77bWX9OzZM5nDlClT5J577pFPP/00iaebxS5dusif//xnuf/++5O4enph1KhRTfR0o3zIIYckG039+emnny4TJkxI/J544gn561//KsOHD0+erb/11lvlxRdfTOa83377yTrrrNPquJVCgDL5zW9+IyNGjBA9Iv+rX/1K3nzzzWTuw4YNk89//vNLZfTDDz+Um2++ORFZ9Gc6nr5rQJ/zHzt2rOjP582bl/zboYcemvCq/Oh4+i16+XPuuefK//7v/8qzzz6bjK8nOXbYYQfZeeedE5PWrq8co/mjAVdddVXCo3v37rLlllvKbrvtlpiW86vz+8Y3viEHHHBAsiaaz6d///5N89PYmjddE6+99lrTWtHn83Xul1xySfKYwz//+U+58sor5eKLL25aG3piQMWC8ePHJzZPP/108p+yCHL11VfLaqutllyrniq45ZZb5K233pI111xTDjrooOTZfxUc9LEHPUWhbL7zne8kwoN+KoWAm266ST755BM56qij5B//+Eer6zX8VxRLCEAAAhCAAAQgAAEIQAACtgRyFwJmzZqVbMw233zzZAPVmhCgm/I77rgj2byuuuqqohurwYMHJ89g68ZfN19f+9rXElFBN2+Vn7///e+Jr27MdZN52223Se/evZNN4/vvv59s2A477LDE7/LLL5dvfetb8u1vf1t0Q67xVDTQF95Vbpp1M6sbbd0k6tx0g/6LX/xC1lprreTb55VXXjn5mW5idcz9999fdNP629/+NtmgqijR2rj6jgDdDOt8dN46looduhnfc889Zfbs2clGtPJZ/kWLFslZZ50lG264oWy99dbJvHSDes455yQb1qFDhybP6ffo0UPuu+8+mTNnTvJvzYUAPRGgY+pnueWWSzh89NFHsvfeeyf/fdlll8nxxx+fbIirXZ8KItWEAN2AK3/dXKt4otz0Wk466SQ55ZRTEnZ6fcq7vCYq59PSMm8uGum16wZdeehH4+njDueff/5SL+/TfzvyyCNl7bXXTgQUHU+FAd3UKyvd8Ot1nnnmmUk+ttpqq4SH5kHXzx//+Mckp8ccc0wiiqivXo/mqywE6Dp/6qmnkn9X8aOt9Wr7a0w0CEAAAhCAAAQgAAEIQAAC4QRyEwJ0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'

      srcBis = if useCid then 'cid:image' else base64bis

      message.body = message.body.replace '{bdc}', "<img src='#{src}' /><img src='#{srcBis}' />"
      if useCid
        message.cids = [ {
          type: 'image/png'
          name: 'BDC'
          base64: bdcBase64.split(',')[1]
          id: 'bdc'
        },
        {
          type: 'image/png'
          name: 'Image'
          base64: base64bis.split(',')[1]
          id: 'image'
        } ]
      message

  renderTo = (project) ->
    emails = (member.email for member in project.team when member.daily is 'to')
    _.filter emails

  renderCc = (project, projectAtRisk) ->
    emails = (member.email for member in project.team when member.daily is 'cc')

    if projectAtRisk
      watchers = (member.email for member in project.team when member.daily is 'watcher')
      emails = emails.concat watchers unless watchers.length == 0

    _.filter emails

  # Given the full list of recipients, return true if there is at least
  # one theodo.fr email address.
  # This function is used to send a copy of the daily mail to the CTO of Theodo.fr
  # only if it is a theodo.fr project (Scrumble is used by other companies)
  isTheodoFrSprint = (emailAdresses) ->
    for email in emailAdresses
      if email.endsWith("theodo.fr")
        return true
    return false


  # If gap < 0 and end of sprint is in less than 2 days, returns true
  # Used to send a copy to the watchers (always CTO + watchers)
  isProjectAtRisk = (sprint) ->
    if _.isArray sprint?.bdcData
      index = sprintUtils.getCurrentDayIndex sprint.bdcData
      diff = sprint.bdcData[index]?.done - sprint.bdcData[index]?.standard
      Math.abs(diff).toFixed 1
      if diff >= 0 # Sprint is ok, no need to send a copy to the CTO
        return false

      if sprint?.dates?.end
        extraDay = if isLastDayAFullDay(sprint.resources.matrix) then -1 else 0
        if (moment().diff(sprint.dates.end, 'days') + extraDay) <= -2 # End of sprint is in more than 2 days
          return false

      return true
    return false

  # The last day in Scrumble might not be the day of the ceremony.
  # 
  # Case 1 : Ceremony is Friday at 9am
  # Team sets Thursday as the last day but Thursday is a full day of code.
  # returns true
  #
  # Case 2 : Ceremony is Friday at 11am
  # Team sets Friday as the last day but Friday is not a full day (only 2hours of code).
  # returns false
  #
  # How it works ?
  # Check if capacity of the team during the last day is over 0.5
  isLastDayAFullDay = (matrix) ->
    [..., lastDayCapacities] = matrix
    # For the last day not to be a full day, every member must have a capacity <= 0.5
    for capacity in lastDayCapacities
      if capacity > 0.5
        return true
    return false

  _svg = null
  dynamicFieldsPromise = null
  prebuildMessage =
    to: null
    cc: null
    subject: null
    body: null
  render: (sections, dailyReport, svg, project, sprint) ->
    _svg = svg
    markdownMessage = ""
    for section in [
      'intro'
      'progress'
      'previousGoalsIntro'
      'previousGoals'
      'todaysGoalsIntro'
      'todaysGoals'
      'problemsIntro'
      'problems'
      'conclusion'
    ]
      continue unless _.isString sections[section]
      if _.includes section, 'Intro'
        if _.isEmpty sections[section.replace('Intro', '')]
          continue
      markdownMessage += sections[section] + "\n\n"
    htmlMessage = converter.makeHtml markdownMessage

    dynamicFieldsPromise = dynamicFields.ready sprint, project

    dynamicFieldsPromise.then (builtDict) ->
      projectAtRisk = isProjectAtRisk sprint

      emailsTo = renderTo project
      emailsCc = renderCc project, projectAtRisk

      # Add TheodoFR scrumble watchers for Theodo.fr projects
      if projectAtRisk and isTheodoFrSprint(emailsTo.concat emailsCc)
        emailsCc.push 'watchscrumble@theodo.fr'

      prebuildMessage =
        to: emailsTo
        cc: emailsCc
        subject: dynamicFields.render sections.subject, builtDict
        body: dynamicFields.render htmlMessage, builtDict

      renderBDC
        to: prebuildMessage.to
        cc: prebuildMessage.cc
        subject: prebuildMessage.subject
        body: prebuildMessage.body
      , svg, false
  buildCid: ->
    dynamicFieldsPromise.then (builtDict) ->
      renderBDC prebuildMessage, _svg, true
